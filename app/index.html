<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <style>
            input[type=number] {
            text-align:right;
            }        
        </style>
        <script src="https://unpkg.com/currency.js/dist/currency.min.js"></script>
        <title>Stylish Portfolio - Start Bootstrap Template</title>
    </head>
    <body id="page-top">
        <form>
            <h2>Gas</h2>
            <div>
                <label for="verbrauch">Jährlicher Gasverbrauch in kWh</label>
                <input type="number" step="1" min="0" id="verbrauch" name="verbrauch" placeholder="13000" value="13000" required />
            </div>
            <div>
                <label for="gas_arbeitspreis">Arbeitspreis in €/kWh</label>
                <input type="number" step="0.001" min="0" id="gas_arbeitspreis" name="gas_arbeitspreis" placeholder="0.220" value="0.220" required />
            </div>
            <div>
                <label for="gas_umlage">Gasumlage in €/kWh</label>
                <input type="number" step="0.001" min="0" id="gas_umlage" name="gas_umlage" placeholder="0.024" value="0.024" required />
            </div>
            <div>
                <label for="gas_fixkosten">Jährliche Fixkosten in € (Wartung, Schornsteinfeger, Grundpreis)</label>
                <input type="number" step="0.01" min="0" id="gas_fixkosten" name="gas_fixkosten" placeholder="120.00" value="120" required />
            </div>
            <h2>Strom</h2>
            <div>
                <label for="strom_arbeitspreis">Arbeitspreis in €/kWh</label>
                <input type="number" step="0.001" min="0" id="strom_arbeitspreis" name="strom_arbeitspreis" placeholder="0.327" value="0.327" required />
            </div>
            <h2>Wärmepumpe</h2>
            <div>
                <label for="arbeitszahl">Arbeitszahl der Wärmepumpe</label>
                <input type="number" step="0.1" min="0" id="arbeitszahl" name="arbeitszahl" placeholder="3" value="3" required />
            </div>
            <h2>Finanzierung</h2>
            <div>
                <label for="begfoerderung">BEG Förderung in %</label>
                <input type="number" step="1" min="0" id="begfoerderung" name="begfoerderung" placeholder="25" value="25" required />
            </div>
            <div>
                <label for="laufzeit">Kreditlaufzeit in Monaten</label>
                <input type="number" step="1" min="0" id="laufzeit" name="laufzeit" placeholder="120" value="120" required />
            </div>
            <div>
                <label for="zinsen">Kreditzinsen in %</label>
                <input type="number" step="0.01" min="0" id="zinsen" name="zinsen" placeholder="2" value="2" required />
            </div>
        </form>
        <div>
            <div>
                <h3>Debug</h3>
                <div id="debug"></div>
            </div>
            <div id="text"></div>
        </div>
        <script>
            function calculate(verbrauch, gas_arbeitspreis, gas_umlage, gas_fixkosten, strom_arbeitspreis, arbeitszahl, begfoerderung, laufzeit, zinsen) {
                let gas_kosten = verbrauch.multiply(gas_arbeitspreis.add(gas_umlage)).add(gas_fixkosten);
                let stromverbrauch = verbrauch.divide(arbeitszahl);
                let strom_kosten = stromverbrauch.multiply(strom_arbeitspreis);
                let ersparnis_jahr = gas_kosten.subtract(strom_kosten)
                let ersparnis_monat = ersparnis_jahr.divide(12)
                let kreditrahmen = currency((ersparnis_jahr.value * (1-Math.pow(zinsen/12+1,-laufzeit))) / zinsen);
                let maxInvestition = kreditrahmen.divide(1-begfoerderung)
                return {
                    'gas_kosten_jahr': gas_kosten,
                    'gas_kosten_monat': gas_kosten.divide(12),
                    'ersparnis_jahr': ersparnis_jahr,
                    'stromverbrauch': stromverbrauch,
                    'strom_kosten_jahr': strom_kosten,
                    'strom_kosten_monat': strom_kosten.divide(12),
                    'ersparnis_monat': ersparnis_monat,
                    'kreditrahmen': kreditrahmen,
                    'maxInvestition': maxInvestition,
                };
            }

            function calculateWrapper() {
                let verbrauch = currency(document.getElementById('verbrauch').value);
                let gas_arbeitspreis = currency(document.getElementById('gas_arbeitspreis').value, {precision: 3});
                let gas_umlage = currency(document.getElementById('gas_umlage').value, {precision: 3});
                let gas_fixkosten = currency(document.getElementById('gas_fixkosten').value);
                let strom_arbeitspreis = currency(document.getElementById('strom_arbeitspreis').value, {precision: 3});

                let arbeitszahl = parseFloat(document.getElementById('arbeitszahl').value);
                let begfoerderung = parseFloat(document.getElementById('begfoerderung').value) / 100;
                let laufzeit = parseFloat(document.getElementById('laufzeit').value);
                let zinsen = parseFloat(document.getElementById('zinsen').value) / 100;

                let result = calculate(verbrauch, gas_arbeitspreis, gas_umlage, gas_fixkosten, strom_arbeitspreis, arbeitszahl, begfoerderung, laufzeit, zinsen);
                
                const markup = `
                Bei einem jährlichen Gasverbrauch von <strong>${Math.floor(verbrauch)} kWh</strong> entstehen Gesamtkosten in
                Höhe von <strong>${result.gas_kosten_jahr} €</strong> oder <strong>${result.gas_kosten_monat} €</strong> pro Monat.<br />
                Um die selbe Heizleistung zu erzeugen, benötigt eine Wärmepumpe mit einer Arbeitszahl von <strong>${arbeitszahl}</strong> nur <strong>${Math.floor(1 / arbeitszahl * 100)} %</strong> der Energie als Strom, also etwa <strong>${Math.floor(result.stromverbrauch)} kWh</strong> 
                für <strong>${result.strom_kosten_jahr} €</strong> pro Jahr bzw. <strong>${result.strom_kosten_monat} €</strong> pro Monat.<br />
                Damit spart die Wärmepumpe <strong>${result.ersparnis_jahr} €</strong> pro Jahr bzw. <strong>${result.ersparnis_monat} €</strong> pro Monat.<br />
                Zu <strong>${zinsen * 100} %</strong> Zinsen und mit einer Laufzeit von <strong>${laufzeit}</strong> Monate könnte mit dieser Ersparnis
                ein Kredit von <strong>${result.kreditrahmen} €</strong> aufgenommen werden. <br />
                Da durch die BEG-Förderung nur <strong>${(1-begfoerderung) * 100} %</strong> der Investition selbst bezahlt werden müssen, 
                ergibt sich eine maximale Investitionssumme von <strong>${result.maxInvestition} €</strong>.
                `

                document.getElementById('debug').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                document.getElementById('text').innerHTML = markup;
            }

            document.getElementById('verbrauch').addEventListener("change", calculateWrapper);
            document.getElementById('gas_arbeitspreis').addEventListener("change", calculateWrapper);
            document.getElementById('gas_umlage').addEventListener("change", calculateWrapper);
            document.getElementById('gas_fixkosten').addEventListener("change", calculateWrapper);
            document.getElementById('strom_arbeitspreis').addEventListener("change", calculateWrapper);
            document.getElementById('arbeitszahl').addEventListener("change", calculateWrapper);
            document.getElementById('begfoerderung').addEventListener("change", calculateWrapper);
            document.getElementById('laufzeit').addEventListener("change", calculateWrapper);
            document.getElementById('zinsen').addEventListener("change", calculateWrapper);
        </script>
    </body>
</html>
